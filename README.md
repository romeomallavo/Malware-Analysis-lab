# Malware Analysis Lab Setup

This repository provides step-by-step instructions to set up a malware analysis lab using both self-hosted (VirtualBox) and cloud-hosted (AWS) environments. Additionally, it summarizes the skills and technologies learned from this project.

## Table of Contents

1. [Introduction](#introduction)
2. [Prerequisites](#prerequisites)
3. [Setup Instructions](#setup-instructions)
    1. [Self-hosted Lab Setup](#self-hosted-lab-setup)
        1. [Install VirtualBox](#install-virtualbox)
        2. [Download Windows 10 ISO](#download-windows-10-iso)
        3. [Download Remnux OVA](#download-remnux-ova)
        4. [Windows 10 VM Setup](#windows-10-vm-setup)
        5. [Install FlareVM](#install-flarevm)
        6. [Remnux Setup](#remnux-setup)
        7. [Setup Host-only Adapter](#setup-host-only-adapter)
        8. [Configure Remnux](#configure-remnux)
    2. [Cloud-hosted Lab Setup](#cloud-hosted-lab-setup)
        1. [Create EC2 Instance](#create-ec2-instance)
        2. [Install FlareVM](#install-flarevm-ec2)
        3. [Export AMI](#export-ami)
        4. [Create IAM Role](#create-iam-role)
        5. [Install Required Tools](#install-required-tools)
        6. [Deploy Cloud-hosted Lab](#deploy-cloud-hosted-lab)
4. [Skills and Technologies Learned](#skills-and-technologies-learned)
5. [References](#references)

## Introduction

This guide helps you set up a malware analysis lab using both self-hosted (VirtualBox) and cloud-hosted (AWS) environments. You will configure an isolated network, install necessary malware analysis tools, and ensure safe execution and analysis of malware.

## Prerequisites

- A computer with at least 8GB of RAM and a dual-core processor
- Internet connection
- Basic knowledge of IT and cybersecurity

## Setup Instructions

### Self-hosted Lab Setup

#### 1. Install VirtualBox

1. Download VirtualBox from the [official website](https://www.virtualbox.org/).
2. Run the installer and follow the on-screen instructions to complete the installation.

#### 2. Download Windows 10 ISO

1. Go to the [Microsoft website](https://www.microsoft.com/en-us/software-download/windows10) and download the Windows 10 Enterprise ISO file.
2. Save the ISO file to a location you can remember.

#### 3. Download Remnux OVA

1. Go to the [Remnux website](https://remnux.org/) and download the Remnux OVA file for VirtualBox.
2. Save the OVA file to a location you can remember.

#### 4. Windows 10 VM Setup

1. Open VirtualBox and click "New" to create a new virtual machine.
2. Name the VM "Windows 10" and set the type to "Microsoft Windows" and version to "Windows 10 (64-bit)".
3. Allocate at least 2GB of RAM and create a virtual hard disk of at least 60GB.
4. Start the VM and mount the Windows 10 ISO file.
5. Follow the installation prompts to install Windows 10.
6. Install Guest Additions to enable full-screen mode.

#### 5. Install FlareVM

1. Download and install Google Chrome inside the Windows 10 VM.
2. Disable Windows Defender:
    - Go to Windows Security settings and turn off real-time protection.
    - Edit Group Policy to disable Windows Defender and Windows Firewall.
3. Download and run the FlareVM installation script:
    - Open PowerShell as an administrator.
    - Run the following commands:
      ```powershell
      Set-ExecutionPolicy Unrestricted -Force
      iwr -Uri https://raw.githubusercontent.com/mandiant/flare-vm/master/install.ps1 -OutFile install.ps1
      .\install.ps1
      ```
4. Follow the prompts to complete the FlareVM installation.

#### 6. Remnux Setup

1. Import the Remnux OVA file into VirtualBox.
2. Start the Remnux VM and log in.
3. Configure inetSim by editing the configuration file:
    ```bash
    sudo nano /etc/inetsim/inetsim.conf
    ```
    - Uncomment and set the required settings.
    - Save and exit the editor.

#### 7. Setup Host-only Adapter

1. In VirtualBox, go to "File" > "Host Network Manager" and create a new host-only network.
2. Configure the network settings as needed.
3. Attach the host-only adapter to both the Windows 10 and Remnux VMs.

#### 8. Configure Remnux

1. Open a terminal in Remnux and run inetSim:
    ```bash
    sudo inetsim
    ```
2. Ensure connectivity between the VMs by pinging each other.

### Cloud-hosted Lab Setup

#### 1. Create EC2 Instance

1. Log in to the AWS Management Console and go to the EC2 Dashboard.
2. Launch a new instance using the Windows Server 2022 Base AMI.
3. Configure instance settings, ensuring you allow RDP traffic.
4. Launch the instance and download the RDP file for connection.

#### 2. Install FlareVM on EC2

1. Connect to the EC2 instance using RDP.
2. Disable Windows Defender and Windows Firewall as described in the self-hosted setup.
3. Download and run the FlareVM installation script as described in the self-hosted setup.

#### 3. Export AMI

1. Stop the EC2 instance once FlareVM is installed.
2. Create an AMI from the stopped instance for future use.

#### 4. Create IAM Role

1. Go to the IAM Dashboard in AWS and create a new user with EC2 Full Access permissions.
2. Save the access key and secret key.

#### 5. Install Required Tools

1. On your local machine, install AWS CLI, Terraform, and JQ.
2. Configure the AWS CLI with your IAM user credentials:
    ```bash
    aws configure
    ```

#### 6. Deploy Cloud-hosted Lab

1. Clone the AWS Malware Lab repository:
    ```bash
    git clone <repository_url>
    cd AWS-Malware-Lab
    ```
2. Edit the configuration files with your AWS details and AMI ID.
3. Initialize and apply Terraform to create the lab environment:
    ```bash
    terraform init
    terraform apply
    ```

## Skills and Technologies Learned

- **Virtualization and VM Management**: Learned to set up and manage virtual machines using VirtualBox and AWS EC2, including configuring network settings and installing operating systems.
- **Malware Analysis Tools**: Gained experience in installing and using malware analysis tools like FlareVM and Remnux to safely analyze and dissect malware.
- **Network Configuration and Security**: Developed skills in setting up isolated networks, configuring host-only adapters, and using tools like inetSim to impersonate various services for malware analysis.

## References

- [VirtualBox](https://www.virtualbox.org/)
- [Windows 10 Download](https://www.microsoft.com/en-us/software-download/windows10)
- [Remnux](https://remnux.org/)
- [FlareVM](https://github.com/mandiant/flare-vm)
- [AWS EC2](https://aws.amazon.com/ec2/)
- [AWS CLI](https://aws.amazon.com/cli/)
- [Terraform](https://www.terraform.io/)
- [JQ](https://stedolan.github.io/jq/)
